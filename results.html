{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- Results Header -->
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-chart-line"></i> Analysis Results
                </h1>
                <p class="lead text-muted">AI-powered analysis of your post</p>
            </div>
            
            <!-- Main Result Card -->
            <div class="card shadow-lg mb-4">
                <div class="card-header {% if prediction == 'fake' %}bg-danger{% else %}bg-success{% endif %} text-white">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="mb-0">
                                <i class="fas fa-{% if prediction == 'fake' %}exclamation-triangle{% else %}check-circle{% endif %}"></i>
                                Prediction: {{ prediction.title() }}
                            </h4>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <h4 class="mb-0">{{ "%.1f"|format(confidence * 100) }}% Confidence</h4>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h5>Original Post:</h5>
                            <div class="alert alert-light">
                                <p class="mb-0">{{ text }}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <canvas id="confidenceChart" width="200" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Explanations -->
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb"></i> Why This Prediction?
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for explanation in explanations %}
                        <li class="list-group-item">
                            <i class="fas fa-arrow-right text-primary me-2"></i>
                            {{ explanation }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            
            <!-- Feature Analysis -->
            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i> Feature Analysis
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <canvas id="featureChart" width="400" height="300"></canvas>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-details">
                                <div class="mb-3">
                                    <strong>Text Length:</strong> {{ features.length }} characters
                                </div>
                                <div class="mb-3">
                                    <strong>Word Count:</strong> {{ features.word_count }} words
                                </div>
                                <div class="mb-3">
                                    <strong>Exclamation Marks:</strong> {{ features.exclamation_count }}
                                </div>
                                <div class="mb-3">
                                    <strong>Caps Ratio:</strong> {{ "%.1f"|format(features.caps_ratio * 100) }}%
                                </div>
                                <div class="mb-3">
                                    <strong>Suspicious Keywords:</strong> {{ features.fake_indicators }}
                                </div>
                                {% if features.followers %}
                                <div class="mb-3">
                                    <strong>Followers:</strong> {{ features.followers }}
                                </div>
                                {% endif %}
                                {% if features.account_age %}
                                <div class="mb-3">
                                    <strong>Account Age:</strong> {{ features.account_age }} days
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recommendations -->
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-shield-alt"></i> Recommendations
                    </h5>
                </div>
                <div class="card-body">
                    {% if prediction == 'fake' %}
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle"></i> This post appears to be FAKE!</h6>
                        <ul class="mb-0">
                            <li>Do not click on any links in this post</li>
                            <li>Do not provide personal information</li>
                            <li>Verify information from official sources</li>
                            <li>Report this post to the platform</li>
                        </ul>
                    </div>
                    {% else %}
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle"></i> This post appears to be REAL!</h6>
                        <ul class="mb-0">
                            <li>No obvious red flags detected</li>
                            <li>Text patterns suggest genuine content</li>
                            <li>Still exercise general caution online</li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Feedback Section -->
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-thumbs-up"></i> Help Us Improve
                    </h5>
                </div>
                <div class="card-body">
                    <p>Was our prediction correct?</p>
                    <form action="{{ url_for('feedback') }}" method="POST" class="d-inline">
                        <input type="hidden" name="post_id" value="{{ post_id }}">
                        <button type="submit" name="feedback" value="correct" class="btn btn-success me-2">
                            <i class="fas fa-thumbs-up"></i> Correct
                        </button>
                        <button type="submit" name="feedback" value="incorrect" class="btn btn-danger">
                            <i class="fas fa-thumbs-down"></i> Incorrect
                        </button>
                    </form>
                    <div class="mt-3">
                        <a href="{{ url_for('analyze') }}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Analyze Another Post
                        </a>
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-home"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Confidence Chart
const ctx1 = document.getElementById('confidenceChart').getContext('2d');
new Chart(ctx1, {
    type: 'doughnut',
    data: {
        labels: ['{{ prediction.title() }}', '{{ "Real" if prediction == "fake" else "Fake" }}'],
        datasets: [{
            data: [{{ confidence * 100 }}, {{ (1 - confidence) * 100 }}],
            backgroundColor: [
                '{% if prediction == "fake" %}#dc3545{% else %}#28a745{% endif %}',
                '{% if prediction == "fake" %}#28a745{% else %}#dc3545{% endif %}'
            ],
            borderWidth: 2,
            borderColor: '#fff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Feature Chart
const ctx2 = document.getElementById('featureChart').getContext('2d');
new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: ['Length', 'Words', 'Exclamations', 'Caps %', 'Suspicious'],
        datasets: [{
            label: 'Values',
            data: [
                {{ features.length }},
                {{ features.word_count }},
                {{ features.exclamation_count }},
                {{ features.caps_ratio * 100 }},
                {{ features.fake_indicators }}
            ],
            backgroundColor: [
                '#007bff',
                '#28a745',
                '#ffc107',
                '#dc3545',
                '#6f42c1'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}

